# КАК ЗАПУСКАТЬ

```docker-compose up --build```


## Безопасное переназначение ревьюеров

Реализация операции переназначения находится в /internal/repository/postgresql/pr.go, в методе Reassign()

Под безопасностью операции я поняла защиту доступа данных от гонок,
в моем решении я использую SELECT FOR UPDATE SKIP LOCKED, который блокирует записи в таблице users и pr, и при этом скипает уже залоченные записи

Алгоритм операции такой:
1) Сначала валидируем входные данные (проверяем, что PR существует, что oldReviewID действительно ревьюер у ПРа и так далее)
2) Находим кандидатов на назначение ревьюером
3) Для каждого кандидата открываем транзакцию и проверяем, что он все еще подходит
   1) Если он больше не подходит, значит кто-то конкурентно его изменил (между пунктом 2 и 3) и мы просто идем к следующему кандидату и снова это же проверяем
   2) Если он подходит - продолжаем транзакцию
4) Лочим pr с помощью SELECT FOR UPDATE SKIP LOCKED и проверяем что он не merged
   1) Если такой селект ничего не вернул, значит строка уже кем то залочена и мы не можем поменять ее значение (возвращаем ошибку NOT_ASSIGNED)
   2) Если селект вернул какой то pr, но status = merged, это значит что кто успел конкурентно поменять pr и мы возвращаем ошибку PR_MERGED
   3) В ином случае - продолжаем транзакцию
5) Обновляем PR, обновляя одного из ревьеров подходящим кандидатом